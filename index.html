<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Beihang&#39;s Tech Blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Beihang&#39;s Tech Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Beihang&#39;s Tech Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>Beihang's Tech Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Beihang's Tech Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">on the way</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Backend-Redis/Redis-事务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Backend-Redis/Redis-事务/" itemprop="url">Redis Transaction</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="事务阶段"><a href="#事务阶段" class="headerlink" title="事务阶段"></a>事务阶段</h2><ul>
<li>标记</li>
<li>入队</li>
<li>执行<h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2>下表列出了 redis 事务的相关命令：</li>
</ul>
<table>
<thead>
<tr>
<th>序号</th>
<th>命令及描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td><a href="http://www.runoob.com/redis/transactions-discard.html" target="_blank" rel="noopener">DISCARD</a>  取消事务，放弃执行事务块内的所有命令。</td>
</tr>
<tr>
<td>2</td>
<td><a href="http://www.runoob.com/redis/transactions-exec.html" target="_blank" rel="noopener">EXEC</a> 执行所有事务块内的命令。</td>
</tr>
<tr>
<td>3</td>
<td><a href="http://www.runoob.com/redis/transactions-multi.html" target="_blank" rel="noopener">MULTI</a> 标记一个事务块的开始。</td>
</tr>
<tr>
<td>4</td>
<td><a href="http://www.runoob.com/redis/transactions-unwatch.html" target="_blank" rel="noopener">UNWATCH</a> 取消 WATCH 命令对所有 key 的监视。</td>
</tr>
<tr>
<td>5</td>
<td><a href="http://www.runoob.com/redis/transactions-watch.html" target="_blank" rel="noopener">WATCH key [key …]</a>  监视一个(或多个) key ，如果在事务执行之前这个(或这些) key 被其他命令所改动，那么事务将被打断。</td>
</tr>
</tbody>
</table>
<h2 id="事务的几种情况"><a href="#事务的几种情况" class="headerlink" title="事务的几种情况"></a>事务的几种情况</h2><ul>
<li>正常情况</li>
<li>放弃事务：discard</li>
<li>全部失败： 有一些错误的命令（Redis里面根本没有的命令）。事务全部放弃。</li>
<li>错误命令失败：错误的使用一些命令（字符串加一），当前命令失败，事务中的其他命令成功。</li>
<li>使用Watch：见下一节<h2 id="Watch"><a href="#Watch" class="headerlink" title="Watch"></a>Watch</h2>乐观锁：不加锁，使用版本号机制，当前修改必须大于版本号才能修改<br>Redis 锁的机制类似于乐观锁。在进行watch监控时，对watch的key进行加锁，当其他客户端或线程对其修改后，当前事务会返回失败。执行了exec，之前加的watch监控都被取消。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Backend-Redis/Redis-基本数据-持久化-2018-09-09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Backend-Redis/Redis-基本数据-持久化-2018-09-09/" itemprop="url">Redis 基本数据 && 持久化</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="基本数据类型以及操作"><a href="#基本数据类型以及操作" class="headerlink" title="基本数据类型以及操作"></a>基本数据类型以及操作</h1><p>基本数据类型： string, hash, list, set, sort set<br>TO DO: 总结数据操作及应用场景</p>
<h1 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h1><p>两种方式： RDB 和 AOF</p>
<h2 id="选择和使用"><a href="#选择和使用" class="headerlink" title="选择和使用"></a>选择和使用</h2><p>（1）只做缓存： 可以都不同<br>（2）同时开启两种方式： 重启时首先加载AOF文件，因为AOF文件比RDB完整<br>（3）不要只用AOF，RDB做后备用途。在Slave上持久化RDB文件，15分钟备份一次，只保留save 900 1 这条规则<br>（4）启动AOF，最坏丢失不超过2秒数据。  a.带来一定的IO b.rewrite 阻塞写到新文件 可以将64M 改写为5G以上<br>（5）不使用AOF 仅靠Master-Slave Replication 实现高可用性，省掉IO，但是如果Master/Slave同时当掉，丢失十几分钟数据，启动脚本时比较 Master/Slave中较新的RDB文件载入。（新浪架构）</p>
<p>启动时先读AOF?</p>
<h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><p>dump.rdb<br>持久化可以在指定的时间间隔内生成数据集的时间点快照<br>默认快照触发条件:</p>
<ul>
<li>1分钟改1万次</li>
<li>or 5分钟改10次</li>
<li>or 15分钟改1次<h3 id="RDB-的优点"><a href="#RDB-的优点" class="headerlink" title="RDB 的优点:"></a>RDB 的优点:</h3>（1）适合大规模数据恢复<br>（2）对数据完整性和一致性要求不高<h3 id="RDB-的缺点"><a href="#RDB-的缺点" class="headerlink" title="RDB 的缺点:"></a>RDB 的缺点:</h3>（1） 丢失最后一次保存的数据<br>（2）本身数据集大，fork() 可能会非常耗时，造成服务器在某某毫秒内停止处理客户端</li>
</ul>
<h2 id="AOF-Append-only-log"><a href="#AOF-Append-only-log" class="headerlink" title="AOF (Append only log)"></a>AOF (Append only log)</h2><p>以日志的形式来记录每个<strong>写</strong>操作，并在服务器启动时，通过重新执行这些命令来还原数据集。 最多丢失一秒数据。<br>redis.conf -&gt; <strong>appendonly.aof</strong></p>
<blockquote>
<p>AOF 启动 ： redis-server /../redis_aof.conf<br>AOF 修复 ： redis-check-aof –fix appendonly.aof (网络故障等)</p>
</blockquote>
<h3 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h3><p>No-appendfsync-on-rewrite no<br>auto-aof-rewrite-min-percentage 100<br>auto-aof-rewrite-min-size 64mb (默认)</p>
<h3 id="Appendfsync"><a href="#Appendfsync" class="headerlink" title="Appendfsync"></a>Appendfsync</h3><ul>
<li>Always : 同步持久化，每次发生数据变更立即记录到硬盘，性能差，数据完整性好<ul>
<li>Everysec : <strong>默认配置</strong>。异步操作，每秒记录一次，有可能1秒数据丢失</li>
<li>No <h3 id="Rewrite"><a href="#Rewrite" class="headerlink" title="Rewrite"></a>Rewrite</h3></li>
<li>AOF文件追加会越来越大，为避免这种情况，新增重写机制，当AOF文件大小超过设定阈值，Redis会启动AOF文件内容压缩，只保留恢复数据的最小指令集，可以使用bgrewriteaof</li>
<li>fork一条新进程 将整个内存钟数据库内容用命令的形式重写一个新的aof文件</li>
<li>记录上一个重写AOF文件大小，默认配置是当AOF文件大小是上次rewrite后的一倍且文件大于64M时触发 redis.conf中（auto-aof-rewrite-min-percentage 100 auto-aof-rewrite-min-size 64mb）<h3 id="AOF优点"><a href="#AOF优点" class="headerlink" title="AOF优点"></a>AOF优点</h3>（1）配置灵活：每秒同步，每修改同步，不同步<h3 id="AOF缺点"><a href="#AOF缺点" class="headerlink" title="AOF缺点"></a>AOF缺点</h3>（1）相同数据aof文件大于rdb<br>（2）AOF运行效率慢于rdb，不同步效率和rdb相同</li>
</ul>
</li>
</ul>
<p>参考博客：<br><a href="https://redis.io/topics/persistence" target="_blank" rel="noopener">官网</a><br><a href="https://www.cnblogs.com/MPPC/p/5924738.html" target="_blank" rel="noopener">解析配置文件 redis.conf、Redis持久化RDB、Redis的主从复制</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Backend-Redis/2018-09-03-Redis-notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Backend-Redis/2018-09-03-Redis-notes/" itemprop="url">redis notes -  lock and queue</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Summary-from-Redis-深度历险"><a href="#Summary-from-Redis-深度历险" class="headerlink" title="Summary from Redis 深度历险"></a>Summary from <a href="https://juejin.im/book/5afc2e5f6fb9a07a9b362527/section/5afc35fb6fb9a07abf72b477" target="_blank" rel="noopener">Redis 深度历险</a></h1><h2 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h2><ol>
<li><p>原子问题 To ensure the automic</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">setnx lock:beihanz true </span><br><span class="line">expire lock:beihanz 5</span><br><span class="line">--&gt; </span><br><span class="line">set lock:beihanz true ex 5 nx</span><br></pre></td></tr></table></figure>
</li>
<li><p>超时问题<br>Redis 的分布式锁不能解决超时问题，如果在加锁和释放锁之间的逻辑执行的太长，以至于超出了锁的超时限制，就会出现问题。因为这时候锁过期了，第二个线程重新持有了这把锁，但是紧接着第一个线程执行完了业务逻辑，就把锁给释放了，第三个线程就会在第二个线程逻辑执行完之间拿到了锁。<br><strong>解决方案</strong>：使用随机数作为锁，然后再释放锁的时候判断是不是当前随机数。</p>
</li>
<li>实现可重入<br>使用ThreadLocal 记录当前锁的计数<h2 id="延时队列"><a href="#延时队列" class="headerlink" title="延时队列"></a>延时队列</h2></li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/GitCLI/git-常用命令2018-09-15/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/GitCLI/git-常用命令2018-09-15/" itemprop="url">Git Config</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h2><p>生效顺序：<strong>3 -&gt; 2 -&gt; 1</strong></p>
<ol>
<li>对系统上所有用户及他们所拥有的仓库都生效 -&gt; /etc/gitconfig<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --system xxx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>Git 会读写这个文件。</p>
<ol start="2">
<li><p>每个用户的~/.gitconfig文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global xxx</span><br></pre></td></tr></table></figure>
</li>
<li><p>各个库中 Git 目录下的配置文件（.git/config）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config xxx</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="设置git分支的跟踪关系"><a href="#设置git分支的跟踪关系" class="headerlink" title="设置git分支的跟踪关系"></a>设置git分支的跟踪关系</h2><h3 id="1、新建一个分支时设置跟踪关系"><a href="#1、新建一个分支时设置跟踪关系" class="headerlink" title="1、新建一个分支时设置跟踪关系"></a>1、新建一个分支时设置跟踪关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git  checkout -b new_branch_name  [--track] origin/remote_branch_name</span><br></pre></td></tr></table></figure>
<p>–track选项可以省略</p>
<h3 id="2、设置已有分支和远端分支的跟踪关系"><a href="#2、设置已有分支和远端分支的跟踪关系" class="headerlink" title="2、设置已有分支和远端分支的跟踪关系"></a>2、设置已有分支和远端分支的跟踪关系</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git  branch -u  origin/remote_branch_name  local_branch_name</span><br></pre></td></tr></table></figure>
<p>注意：-u选项是–set-upstream-to的简写，因此上面这条命令可以写作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git  branch --set-upstream-to=origin/remote_branch_name  local_branch_name</span><br></pre></td></tr></table></figure></p>
<p>local_branch_name可以省略，默认值为当前分支</p>
<h2 id="多个git-ssh-key-问题"><a href="#多个git-ssh-key-问题" class="headerlink" title="多个git ssh key 问题"></a>多个git ssh key 问题</h2><p><a href="https://www.jianshu.com/p/f7f4142a1556" target="_blank" rel="noopener">https://www.jianshu.com/p/f7f4142a1556</a></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://sandwind.gitbooks.io/git-pro-cn/content/git-base/get.html" target="_blank" rel="noopener">https://sandwind.gitbooks.io/git-pro-cn/content/git-base/get.html</a><br><a href="https://www.jianshu.com/p/82123524e1c0" target="_blank" rel="noopener">本地git config配置和git基本操作</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Java-Powermock/powermock-series-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Java-Powermock/powermock-series-1/" itemprop="url">PowerMock Series 1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="PowerMock-and-Mockito-Learning"><a href="#PowerMock-and-Mockito-Learning" class="headerlink" title="PowerMock-and-Mockito-Learning"></a>PowerMock-and-Mockito-Learning</h2><h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B" target="_blank" rel="noopener">使用实例</a></h2><p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#1-%E6%A8%A1%E6%8B%9F%E6%8E%A5%E5%8F%A3%E8%BF%94%E5%9B%9E" target="_blank" rel="noopener">1. 模拟接口返回</a></p>
<p>InterfaceToMock mock = PowerMockito.mock(InterfaceToMock.class);</p>
<p>Powermockito.when(mock.method(Params…)).thenReturn(value);</p>
<p>Powermockito.when(mock.method(Params…)).thenThrow(Exception);</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#2%E8%AE%BE%E7%BD%AE%E5%AF%B9%E8%B1%A1private%E5%B1%9E%E6%80%A7" target="_blank" rel="noopener">2.设置对象private属性</a></p>
<p>使用 whitebox 向 class 或者对象中赋值</p>
<p>Whitebox.setInternalState(Object object, String fieldname, Object… value)</p>
<p>object 为需要设置属性的静态类或者对象</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#3%E6%A8%A1%E6%8B%9F%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0" target="_blank" rel="noopener">3.模拟构造函数</a></p>
<p>加入注释</p>
<p>@RunWith(PowerMockRunner.class)</p>
<p>@PrepareForTest({InstanceClass.class})</p>
<p>@PowerMockIgnore(“javax.management.*”)</p>
<p>Powermockito.whenNew(InstanceClass.class).thenReturn(Object value)</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#4%E6%A8%A1%E6%8B%9F%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">4.模拟静态方法</a></p>
<p>类似于模拟构造函数 加入注释</p>
<p>@RunWith(PowerMockRunner.class)</p>
<p>@PrepareForTest({StaticClassToMock.class})</p>
<p>@PowerMockIgnore(“javax.management.*”)</p>
<p>Powermockito.mockStatic(StaticClassToMock.class);</p>
<p>Powermockito.when(StaticClassToMock.method(Object… params)).thenReturn(Object value)</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#5%E6%A8%A1%E6%8B%9Ffinal%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">5.模拟final方法</a></p>
<p>Final方法的模拟类似于模拟静态方法</p>
<p>@RunWith(PowerMockRunner.class)</p>
<p>@PrepareForTest({FinalClassToMock.class})模拟</p>
<p>@PowerMockIgnore(“javax.management.*”)</p>
<p>Powermockito.mockStatic(FinalClassToMock.class);</p>
<p>Powermockito.when(StaticClassToMock.method(Object… params)).thenReturn(Object value)</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#6%E6%A8%A1%E6%8B%9F%E9%9D%99%E6%80%81%E7%B1%BB" target="_blank" rel="noopener">6.模拟静态类</a></p>
<p>类似于模拟静态方法</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#7%E4%BD%BF%E7%94%A8spy%E6%96%B9%E6%B3%95%E9%81%BF%E5%85%8D%E6%89%A7%E8%A1%8C%E8%A2%AB%E6%B5%8B%E7%B1%BB%E4%B8%AD%E7%9A%84%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0" target="_blank" rel="noopener">7.使用spy方法避免执行被测类中的成员函数</a></p>
<p>例如 被测试类为： TargetClass,想要屏蔽的方法为targetMethod.</p>
<p>1) PowerMockito.spy(TargetClass.class);</p>
<p>2) Powermockito.when(TargetClass.targetMethod()).doReturn()</p>
<p>3) 加入注释</p>
<p>@RunWith(PowerMockRunner.class)</p>
<p>@PrepareForTest(DisplayMoRelationBuilder.class)</p>
<p>@PowerMockIgnore(“javax.management.*”)</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#8%E5%8F%82%E6%95%B0%E5%8C%B9%E9%85%8D%E5%99%A8" target="_blank" rel="noopener">8.参数匹配器</a></p>
<p>Mockito.anyInt(), Mockito.anyString()</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#9%E5%A4%84%E7%90%86public-void-%E7%B1%BB%E5%9E%8B%E7%9A%84%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">9.处理public void 类型的静态方法</a></p>
<p>Powermockito.doNothing.when();</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E5%A6%82%E6%9E%9C%E6%83%B3%E4%BD%BF%E7%94%A8mock-spy-injectmocks%E7%AD%89%E6%B3%A8%E8%A7%A3%E6%97%B6%E9%9C%80%E8%A6%81%E8%BF%9B%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%90%8E%E6%89%8D%E8%83%BD%E4%BD%BF%E7%94%A8" target="_blank" rel="noopener">如果想使用@Mock, @Spy, @InjectMocks等注解时，需要进行初始化后才能使用。</a></p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%9A%84%E6%96%B9%E6%B3%95%E6%9C%893%E7%A7%8D" target="_blank" rel="noopener">初始化的方法有3种：</a></p>
<p>1，在Junit的类上面使用@RunWith(MockitoJUnitRunner.class)注解。 但如果你使用的是Spring的话，可能你会使用Spring的测试类（@RunWith(SpringJUnit4ClassRunner.class)） 这样的话，你就没有办法使用上面的@RunWith(SpringJUnit4ClassRunner.class)。你还可以使用下面的方法。</p>
<p>2，在测试方法被调用之前，使用MockitoAnnotations.initMocks(this);。例如： @Before public void initMocks(){ MockitoAnnotations.initMocks(this); } @Before保证了在被测试的方法被调用之前，调用@Before所注解的方法 这个方法还有下面的好处。（具体是什么样子还没有试过） Allows shorthand creation of objects required for testing. Minimizes repetitive mock creation code. Makes the test class more readable. Makes the verification error easier to read because field name is used to identify the mock.</p>
<p>3，使用MockitoRule。如下： @Rule public MockitoRule rule = MockitoJUnit.rule(); 这个方法会调用validateMockitoUsage方法。这个方法有一些好处，具体什么好处还不太清楚。</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#mock-exception" target="_blank" rel="noopener">mock Exception</a></p>
<p>PowerMockito.when(objectMapper.readValue(TEST_STRING1, Map.class)).thenThrow(IOException.class);</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#mock-exception" target="_blank" rel="noopener">mock abstract Exception</a></p>
<p>Mockito.when(mockDAO.getDatabaseResults()).thenThrow(Mockito.mock(ProblemException.class));</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E6%A8%A1%E6%8B%9Fprivate%E5%87%BD%E6%95%B0%E5%92%8C%E5%B1%80%E9%83%A8%E6%A8%A1%E6%8B%9F" target="_blank" rel="noopener">模拟private函数和局部模拟</a></p>
<p>参考<a href="https://www.ibm.com/developerworks/cn/java/j-lo-powermock/" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/java/j-lo-powermock/</a></p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E6%A8%A1%E6%8B%9F%E7%A7%81%E6%9C%89%E4%BB%A5%E5%8F%8A-final-%E6%96%B9%E6%B3%95" target="_blank" rel="noopener">模拟私有以及 Final 方法</a></p>
<p>局部模拟则提供了另外一种方式，在使用局部模拟时，被创建出来的模拟对象依然是原系统对象，虽然可以使用方法 When().thenReturn()来指定某些具体方法的 返回值，但是没有被用此函数修改过的函数依然按照系统原始类的方式来执行。这种局部模拟的方式的强大之处在于，除开一般方法可以使用之外，Final 方法和私有方法一样可以使用。</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E8%A2%AB%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81" target="_blank" rel="noopener">被测试代码</a></p>
<p>public final class PrivatePartialMockingExample {</p>
<p>public String methodToTest() {</p>
<p>return methodToMock(“input”);</p>
<p>}</p>
<p>private String methodToMock(String input) {</p>
<p>return “REAL VALUE = “ + input;</p>
<p>}</p>
<p>}</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#%E5%B1%80%E9%83%A8%E6%A8%A1%E6%8B%9F%E6%96%B9%E6%B3%95%E5%AE%9E%E7%8E%B0" target="_blank" rel="noopener">局部模拟方法实现</a></p>
<p>@RunWith(PowerMockRunner.class)</p>
<p>@PrepareForTest(PrivatePartialMockingExample.class)</p>
<p>public class PrivatePartialMockingExampleTest {</p>
<p>@Test</p>
<p>public void demoPrivateMethodMocking() throws Exception {</p>
<p>final String expected = “TEST VALUE”;</p>
<p>final String nameOfMethodToMock = “methodToMock”;</p>
<p>final String input = “input”;</p>
<p>PrivatePartialMockingExample underTest = spy(new PrivatePartialMockingExample());</p>
<p>/*</p>
<p>* Setup the expectation to the private method using the method name</p>
<p>*/</p>
<p>when(underTest, nameOfMethodToMock, input).thenReturn(expected);</p>
<p>assertEquals(expected, underTest.methodToTest());</p>
<p>// Optionally verify that the private method was actually called</p>
<p>verifyPrivate(underTest).invoke(nameOfMethodToMock, input);</p>
<p>}</p>
<p>}</p>
<p>可以发现，为了实现局部模拟操作，用来创建模拟对象的函数从 mock() 变成了 spy()，操作对象也从类本身变成了一个具体的对象。同时，When() 函数也使用了不同的版本：在模拟私有方法或者是 Final 方法时，When() 函数需要依次指定模拟对象、被指定的函数名字以及针对该函数的输入参数列表。</p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#powermock-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-httpsgithubcompowermockpowermock" target="_blank" rel="noopener">powermock 官方文档</a><a href="https://github.com/powermock/powermock" target="_blank" rel="noopener">https://github.com/powermock/powermock</a></p>
<p><a href="https://github.com/pointedWalnutZhang/PowerMock-and-Mockito-Learning-#mockito-%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-httpsgithubcommockitomockito" target="_blank" rel="noopener">mockito 官方文档</a><a href="https://github.com/mockito/mockito" target="_blank" rel="noopener">https://github.com/mockito/mockito</a></p>
<p>Powermock whennew no effect </p>
<p><a href="https://stackoverflow.com/questions/25317804/using-powermockito-whennew-is-not-getting-mocked-and-original-method-is-called" target="_blank" rel="noopener">https://stackoverflow.com/questions/25317804/using-powermockito-whennew-is-not-getting-mocked-and-original-method-is-called</a></p>
<p>notice</p>
<p>\1. whitebox.setIntenal..对于设置类final 静态变量不起作用</p>
<p>\2. mock exception 以后貌似再赋值给新的mock 不起作用</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Java-Powermock/powermock-series-2---测试私有方法，私有构造函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Java-Powermock/powermock-series-2---测试私有方法，私有构造函数/" itemprop="url">PowerMock Series 2</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>use : rely on EasyMock or Mockito and a test framework</p>
<h1 id="Bypass-Encapsulation-mock-绕过封装"><a href="#Bypass-Encapsulation-mock-绕过封装" class="headerlink" title="Bypass Encapsulation mock 绕过封装"></a>Bypass Encapsulation mock 绕过封装</h1><p>翻译自<br><a href="https://github.com/powermock/powermock/wiki/Bypass-Encapsulation" target="_blank" rel="noopener">https://github.com/powermock/powermock/wiki/Bypass-Encapsulation</a></p>
<h2 id="Quick-summary"><a href="#Quick-summary" class="headerlink" title="Quick summary"></a>Quick summary</h2><p><a href="http://www.javadoc.io/doc/org.powermock/powermock-reflect/1.7.1" target="_blank" rel="noopener">Whitebox</a></p>
<p>class provides a set of methods which could you help bypass encapsulation if it required. Usually, it’s not a good idea to get/modify non-public fields, but sometimes it’s only way to cover code by test for future refactoring.</p>
<ol>
<li>Use <code>Whitebox.setInternalState(..)</code> to set a non-public member of an instance or class. 设置内部私有成员</li>
<li>Use <code>Whitebox.getInternalState(..)</code> to get a non-public member of an instance or class. 获取内部私有成员</li>
<li>Use <code>Whitebox.invokeMethod(..)</code> to invoke a non-public method of an instance or class. 调用私有方法</li>
<li>Use <code>Whitebox.invokeConstructor(..)</code> to create an instance of a class with a private constructor. 调用私有构造函数<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2></li>
</ol>
<ul>
<li>1 调用私有方法<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private int sum(int a, int b) &#123;</span><br><span class="line">	return a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int sum = Whitebox.&lt;Integer&gt; invokeMethod(myInstance, &quot;sum&quot;, 1, 2);</span><br></pre></td></tr></table></figure>
<ul>
<li>2 私有方法重载情况<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">private int myMethod(int id) &#123;		</span><br><span class="line">	return 2*id;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private int myMethod(Integer id) &#123;		</span><br><span class="line">		return 3*id;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>根据传入参数class判断用哪个<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int result = Whitebox.&lt;Integer&gt; invokeMethod(myInstance, new Class&lt;?&gt;[]&#123;int.class&#125;, &quot;myMethod&quot;, 1);</span><br></pre></td></tr></table></figure></p>
<ul>
<li>3 调用私有构造器<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public class PrivateConstructorInstantiationDemo &#123;</span><br><span class="line"></span><br><span class="line">	private final int state;</span><br><span class="line"></span><br><span class="line">	private PrivateConstructorInstantiationDemo(int state) &#123;</span><br><span class="line">		this.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int getState() &#123;</span><br><span class="line">		return state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PrivateConstructorInstantiationDemo instance =  WhiteBox.invokeConstructor(</span><br><span class="line">				PrivateConstructorInstantiationDemo.class, 43);</span><br></pre></td></tr></table></figure></p>
<ul>
<li><ol start="4">
<li>构造器重载的情况<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class PrivateConstructorInstantiationDemo &#123;</span><br><span class="line"></span><br><span class="line">	private final int state;</span><br><span class="line"></span><br><span class="line">	private PrivateConstructorInstantiationDemo(int state) &#123;</span><br><span class="line">		this.state = state;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	private PrivateConstructorInstantiationDemo(Integer state) &#123;</span><br><span class="line">              this.state = state;</span><br><span class="line">              // do something else</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public int getState() &#123;</span><br><span class="line">		return state;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
</ul>
<p>调用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PrivateConstructorInstantiationDemo instance = Whitebox.invokeConstructor(PrivateConstructorInstantiationDemo.class, new Class&lt;?&gt;[]&#123;Integer.class&#125;, 43);</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/Java-Powermock/powermock-series-3---Suppress-Unwanted-Behavior/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/Java-Powermock/powermock-series-3---Suppress-Unwanted-Behavior/" itemprop="url">Power Mock series 3 - Suppress unwanted behavior</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Suppressing-Unwanted-Behavior"><a href="#Suppressing-Unwanted-Behavior" class="headerlink" title="Suppressing Unwanted Behavior"></a>Suppressing Unwanted Behavior</h1><h2 id="Quick-summary"><a href="#Quick-summary" class="headerlink" title="Quick summary"></a><a href="https://github.com/powermock/powermock/wiki/Suppress-Unwanted-Behavior#quick-summary" target="_blank" rel="noopener"></a>Quick summary</h2><ol>
<li>Use the <code>@RunWith(PowerMockRunner.class)</code> annotation at the class-level of the test case.</li>
<li>Use the <code>@PrepareForTest(ClassWithEvilParentConstructor.class)</code> annotation at the class-level of the test case in combination with<br><code>suppress(constructor(EvilParent.class))</code> to suppress all constructors for the EvilParent class.</li>
<li>Use the  <code>Whitebox.newInstance(ClassWithEvilConstructor.class)</code> method to instantiate a class without invoking the constructor what so ever.</li>
<li><p>Use the <code>@SuppressStaticInitializationFor(&quot;org.mycompany.ClassWithEvilStaticInitializer&quot;)</code>annotation to remove the static initializer for the the <code>org.mycompany.ClassWithEvilStaticInitializer</code></p>
<p>class.</p>
</li>
<li>Use the<code>@PrepareForTest(ClassWithEvilMethod.class)</code><br>annotation at the class-level of the test case in combination with<br><code>suppress(method(ClassWithEvilMethod.class, &quot;methodName&quot;))</code><br>to suppress the method with name “methodName” in the ClassWithEvilMethod class.</li>
<li>Use the <code>@PrepareForTest(ClassWithEvilField.class)</code><br>annotation at the class-level of the test case in combination with<br><code>suppress(field(ClassWithEvilField.class, &quot;fieldName&quot;))</code><br>to suppress the field with name “fieldName” in the ClassWithEvilField class.</li>
</ol>
<p>You’ll find the member modification and member matcher methods here:</p>
<ul>
<li><code>org.powermock.api.support.membermodification.MemberModifier</code></li>
<li><code>org.powermock.api.support.membermodification.MemberMatcher</code></li>
</ul>
<h2 id=""><a href="#" class="headerlink" title=""></a><a href="https://github.com/powermock/powermock/wiki/Suppress-Unwanted-Behavior#example" target="_blank" rel="noopener"></a></h2>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/16/UML/UML-2018-09-04/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Beihang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Beihang's Tech Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/16/UML/UML-2018-09-04/" itemprop="url">UML 类图</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-16T10:20:41+08:00">
                2018-09-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>转自 <a href="https://blog.csdn.net/xiehuimx/article/details/53427452" target="_blank" rel="noopener">UML 类图详解</a></p>
<h2 id="类信息"><a href="#类信息" class="headerlink" title="类信息"></a>类信息</h2><p><img src="https://upload-images.jianshu.io/upload_images/2325930-73a3e29608c58a5f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="类图"></p>
<h3 id="类名"><a href="#类名" class="headerlink" title="类名"></a>类名</h3><ul>
<li>Abstract 右下角 {abstract}<br><img src="https://upload-images.jianshu.io/upload_images/2325930-d810c533c393eb95.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="abstract class"><h3 id="类变量"><a href="#类变量" class="headerlink" title="类变量"></a>类变量</h3></li>
<li><strong>格式</strong> ：可见性  名称:类型 [ = 默认值 ]</li>
<li>private,public 和protected,在类图中分别用符号-、+和#表示<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3></li>
<li><strong>格式</strong> ： 可见性  名称(参数列表) [ : 返回类型]</li>
</ul>
<h2 id="类之间的关系"><a href="#类之间的关系" class="headerlink" title="类之间的关系"></a>类之间的关系</h2><h3 id="泛化-Generalization-关系"><a href="#泛化-Generalization-关系" class="headerlink" title="泛化(Generalization)关系"></a>泛化(Generalization)关系</h3><ul>
<li>概念 ： 类和类，接口和接口继承关系</li>
<li>图形表示： 带空心三角形的直线</li>
<li>例子：<br><img src="https://upload-images.jianshu.io/upload_images/2325930-263b1e6e60a76d2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="继承"><h3 id="实现（Realization-关系"><a href="#实现（Realization-关系" class="headerlink" title="实现（Realization)关系"></a>实现（Realization)关系</h3></li>
<li>概念 ： 一个类和接口之间的关系</li>
<li>图形表示： 带空心的三角形的虚线</li>
<li>例子：<br><img src="https://upload-images.jianshu.io/upload_images/2325930-f0b544712b5ee6ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="实现"><h3 id="依赖-Dependence-关系"><a href="#依赖-Dependence-关系" class="headerlink" title="依赖(Dependence)关系"></a>依赖(Dependence)关系</h3></li>
<li>概念 ：一个类中方法有另一个类作为参数</li>
<li>图形表示： 带箭头的虚线</li>
<li>例子： Students 与Bicyle 的关系<br><img src="https://upload-images.jianshu.io/upload_images/2325930-ff33f0199649c203.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="依赖"><h3 id="关联（Association）关系"><a href="#关联（Association）关系" class="headerlink" title="关联（Association）关系"></a>关联（Association）关系</h3></li>
<li>概念 ：关联关系表示一个类和另一类有联系，类成员变量是另一个类</li>
<li>图形表示：带箭头的实线</li>
<li>例子： Teacher和Address就形成了一对一的关联关系<br><img src="https://upload-images.jianshu.io/upload_images/2325930-5ee6b3c3c38501ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="关联"><h3 id="聚合-Aggregation-关系"><a href="#聚合-Aggregation-关系" class="headerlink" title="聚合(Aggregation)关系"></a>聚合(Aggregation)关系</h3></li>
<li>概念 ：关联关系表示一个类和另一类有联系，类成员变量是另一个类</li>
<li>图形表示：带空心菱形的直线</li>
<li>例子： 一个Teachers对象有一辆汽车Car<br><img src="https://upload-images.jianshu.io/upload_images/2325930-c1ce85f3ac62e9d6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="聚合"><h3 id="组合-Composition-关系"><a href="#组合-Composition-关系" class="headerlink" title="组合(Composition)关系"></a>组合(Composition)关系</h3></li>
<li>概念 ：组合关系也是一种部分和整体的关系，但是部分存活周期受到整体的影响，若整体不存在则部分也将不存在</li>
<li>图形表示：带实心菱形的直线</li>
<li>例子： 一个手对象有一个手指<br><img src="https://upload-images.jianshu.io/upload_images/2325930-4861ca22914287ff.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="组合"></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Beihang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Beihang</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
